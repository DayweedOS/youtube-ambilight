html[data-ambilight-enabled="true"] {
  /* General */

  &[dark="true"] {
    &,
    &[lang],
    &[style],
    body {
      background: #000 !important;
      background-color: #000 !important;
    }
  }

  /* Cosmetics - Transparent elements */

  body.at-top ytd-app[is-watch-page] {
    ytd-masthead,
    #container.ytd-searchbox,
    #search-icon-legacy {
      background: none !important;
    }
  }

  ytd-app[is-watch-page] {
    &,
    ytd-watch,
    ytd-watch-flexy,
    #player-theater-container,
    #columns.ytd-watch-flexy,
    #player-container,
    .html5-main-video {
      background: none !important;
    }

    ytd-masthead {
      transition: background-color .15s;
    }
    #masthead-container.ytd-app::after {
      display: none;
    }
  }

  body:not(.ambilight-disable-in-fullscreen) ytd-app[is-watch-page] #movie_player {
    background: none !important;
  }

  /* Video preview background */

  /* ytd-app[is-watch-page] .ytp-storyboard-framepreview {
      margin: 0 auto;
      position: relative;
      display: table;
  }

  ytd-app[is-watch-page] .ytp-storyboard-framepreview-img {
      margin: 0 !important;
  } */

  /* Theater mode */

  body.immersive-mode ytd-watch-flexy[theater]:not([fullscreen]) #player-theater-container.ytd-watch-flexy {
      margin-top: 28px;
      margin-bottom: 85px;
  }

  ytd-app[is-watch-page] .html5-main-video {
      transform: var(--video-transform);
  }


  /* Chat */

  yt-live-chat-renderer {
      background: none !important;
  }
  #message.yt-live-chat-text-message-renderer {
      color: #fff;
  }
  #author-name.yt-live-chat-author-chip {
      color: #bbb;
  }


  /* Cosmetics - Search */

  body.at-top ytd-app[is-watch-page] #search-form * {
      border-color: rgba(255,255,255,.6) !important;
      color: rgba(255,255,255,1) !important;
      fill: rgba(255,255,255,1) !important;
      transition: all .15s;
  }

  body.at-top ytd-app[is-watch-page] #search::-webkit-input-placeholder {
      color: rgba(255,255,255,.6) !important;
  }

  ytd-app[is-watch-page] #search-form {
      transition: opacity .15s, filter .15s;
  }
  body.at-top ytd-app[is-watch-page] #search-form {
    &:not(:hover):not(:focus-within) {
      opacity: .15;
    }
    &:hover,
    &:focus-within {
      background: #121212 !important;
      border-radius: 2px;
      button {
        background: #ffffff14 !important;
      }
      * {
        border-color: rgba(55,55,55,.6) !important;
        color: rgba(255,255,255,1) !important;
        fill: rgba(255,255,255,1) !important;
      }
    }
  }

  /* Cosmetics - Text visibility */

  ytd-app[is-watch-page] ytd-watch #top > #player {
      z-index: 2;
  }

  &[dark="true"] ytd-app[is-watch-page] #playlist yt-icon {
      fill: rgba(255, 255, 255, 0.882) !important;
  }
  &[dark="true"] ytd-app[is-watch-page] #playlist a,
  &[dark="true"] ytd-app[is-watch-page] #index.ytd-playlist-panel-video-renderer,
  &[dark="true"] ytd-app[is-watch-page] span.yt-view-count-renderer {
      color: rgba(255, 255, 255, 0.882) !important;
  }

  ytd-app[is-watch-page] .header.ytd-playlist-panel-renderer,
  ytd-app[is-watch-page] .playlist-items.ytd-playlist-panel-renderer {
      background: none !important;
  }
  ytd-app[is-watch-page] ytd-playlist-panel-video-renderer:hover:not(.dragging) {
    background-color: rgba(20,20,20,.15);
  }

  /* Ambilight */

  .ambilight,
  .ambilight__container,
  .ambilight__canvas-list,
  .ambilight__canvas,
  .ambilight__shadow,
  .ambilight__clip-container,
  .ambilight__player-container {
      position: absolute;
      width: 100%;
      height: 100%;
  }

  .ambilight {
      height: 300%;
      overflow: hidden;
      pointer-events: none;
  }

  .ambilight__clip-container {
    //overflow: hidden;
  }

  .ambilight__container {
      //transition: opacity .15s;
      opacity: 0;
  }

  .ambilight__canvas {
      background: #000;
      /* image-rendering: pixelated; */
  }

  /* Immersive mode */

  body.immersive-mode::-webkit-scrollbar {
    width: 0;
  }

  ytd-app[is-watch-page] #secondary,
  ytd-app[is-watch-page] #masthead-container {
    transition: opacity .15s ease-out;
    will-change: opacity;
    transition-delay: 0s;
  }
  body.immersive-mode.at-top ytd-app[is-watch-page] #secondary:not(:hover),
  body.immersive-mode.at-top ytd-app[is-watch-page] #masthead-container:not(:hover) {
    opacity: 0;
    transition-delay: 1s;
  }

  body.immersive-mode ytd-app[is-watch-page] #primary-inner > *:not(#player) {
    transition: opacity .15s ease-out;
    will-change: opacity;
  }
  body.immersive-mode.at-top ytd-app[is-watch-page] #primary-inner > *:not(#player) {
      opacity: 0;
      transition-delay: 1s;
  }

  body.immersive-mode.at-top ytd-app[is-watch-page] #primary-inner > *:not(#player):hover {
    opacity: 1;
    transition-delay: 0s;
  }
}

/* Settings */

.ytp-ambilight-settings-menu {
  width: 300px;
  max-height: calc(100% - 90px);
  overflow-y: auto !important;
  right: 12px;
  bottom: 49px;
  z-index: 71;
  will-change: width,height;
  opacity: 0;
  pointer-events: none;
  transition: opacity .25s;
}
ytd-watch-flexy[fullscreen] .ytp-ambilight-settings-menu {
  width: 440px;
}
.ytp-ambilight-settings-menu.is-visible {
  opacity: 1;
  pointer-events: all;
}
.ytp-ambilight-settings-menu .ytp-panel {
  position: relative;
}
.ytp-ambilight-settings-button {
  position: relative;
  &::after {
  content: '';
    position: absolute;
    top: 10px;
    right: 5px;
    height: 9px;
    width: 13px;
    background-color: #3ea6ff;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAJCAYAAADpeqZqAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZDQTYxN0E5RkNCMTExRThBMEU4QUNFNjNEOUFBNDhFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZDQTYxN0FBRkNCMTExRThBMEU4QUNFNjNEOUFBNDhFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkNBNjE3QTdGQ0IxMTFFOEEwRThBQ0U2M0Q5QUE0OEUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkNBNjE3QThGQ0IxMTFFOEEwRThBQ0U2M0Q5QUE0OEUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7180+BAAAAVElEQVR42mL8//8/A6mAiYEMgE3TfyhG5qMAFnQNjIyM08EMiLsZsdnEiOYnZIUwNoZmFhzOI81PIOfBnIjLnyzoGoBUFpQNE4YbAPMKIznxBBBgAAy8HWz0TJJgAAAAAElFTkSuQmCC');
    border-radius: 1px;
    line-height: normal;
    font-size: 7px;
    text-align: center;
    text-shadow: rgb(0,0,0) 1px 1px 1px;
  }
}

.ytp-ambilight-settings-button {
  svg {
    transition: transform .1s cubic-bezier(0.4,0.0,1,1);
  }
  &[aria-expanded="true"] svg {
    transform: rotateZ(30deg);
  }
}

.ytp-chrome-bottom {
  width: calc(100% - 24px) !important;
}

.ytp-ambilight-settings-menu .ytp-menuitem[aria-checked="true"] .ytp-menuitem-toggle-checkbox {
  background-color: #3ea6ff;
}

.html5-video-player .ytp-ambilight-settings-menu .ytpa-feedback-link {
  display: table-row;
  height: 25px;
  
  ytd-watch-flexy[fullscreen] & {
    height: 40px;
  }
}

.ytp-ambilight-settings-menu .ytpa-feedback-link__text {
  position: absolute;
  display: block;
  padding: 10px 15px;
  color: #3ea6ff;
  &:hover {
    color: #5ebfff;
    text-decoration: underline;
  }

  ytd-watch-flexy[fullscreen] & {
    padding: 15px 20px;
    font-size: 16px;
  }
}

.html5-video-player .ytp-ambilight-settings-menu a {
  color: #3ea6ff;
  &:hover {
    color: #5ebfff;
    text-decoration: underline;
  }
}

.ytap-menuitem--new .ytp-menuitem-label {
  &::before {
    content: 'N';
    position: absolute;
    left: 2px;
    margin-top: 2px;
    width: 11px;
    height: auto;
    display: block;
    border-radius: 50%;
    background: #fd0;
    color: #000a;
    font-weight: 600;
    font-size: 7px;
    text-shadow: none;
    text-align: center;
    line-height: 11px;

    ytd-watch-flexy[fullscreen] & {
      margin-top: 8px;
    }
  }

}

.ytap-section {
  display: table-row;
  font-weight: 600;
  filter: drop-shadow(rgb(0, 0, 0, .5) 0px 1px 0px) drop-shadow(rgb(0, 0, 0, .25) 0px -1px 0px);

  &__cell {
    display: table-cell;
  }

  &__label,
  &__fill {
    height: 20px;
    line-height: 20px;
    margin-top: 12px;
    margin-bottom: 3px;
    border-top: 1px solid #ffffff10;
    border-bottom: 1px solid #ffffff05;
    padding: 0px 14px;
    line-height: 21px;
    background: #5556;
    color: #ccc;
    ytd-watch-flexy[fullscreen] & {
      padding: 0px 20px;
      height: 30px;
      line-height: 30px;
    }
  }
  &__fill {
    color: transparent;
  }
}

/* Settings - sliders */

.ytp-menuitem {
  transition: background-color .15s;
  &[role="menuitemrange"]:hover {
    background: none !important;
    cursor: default !important;
  }
}

.ytp-menuitem-range {
  display: table-row;
  height: 6px;
  
  input[type="range"] {
    position: absolute;
    display: table-row;
    -webkit-appearance: none;
    background: none;
    cursor: pointer;
    width: calc(100% - 28px);
    margin: 0 14px;
    outline: 0;
    &::-webkit-slider-runnable-track {
      -webkit-appearance: none;
      background: linear-gradient(transparent 42%, rgba(255,255,255,0.3) 43%, rgba(255,255,255,0.3) 57%, transparent 58%);
      height: 21px;
      margin: -10px 0;
      outline: none;
    }
    &::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 17px;
      width: 17px;
      margin-top: 2px;
      border-radius: 50%;
      background: #bdbdbd;
      box-shadow: 0 1px 5px 0 rgba(0,0,0,0.6);
      transition: all .15s;
    }
    &:hover::-webkit-slider-thumb {
      background: #fff;
    }
  }
}


/* Settings - Immersive mode button */

body .toggle-auto-hide-btn {
  position: relative;
  top: -12px;
  line-height: 1px;
  text-align: center;
  font-size: 17px;
  color: #eee;
  cursor: pointer;
  transition: color .2s;
  &::before {
    content: 'IM';
  }
  &:hover {
    color: #fff;
    text-shadow: #000 0px 0px 2px;
  }
}
body.immersive-mode .toggle-auto-hide-btn {
  font-weight: bold;
}


/* FPS */

.ambilight__fps-container {
  position: absolute;
  z-index: 2;
  top: 5px;
  left: 5px;
  filter: drop-shadow(1px 0 0 #000) drop-shadow(-1px 0 0 #000) drop-shadow(0 1px 0 #000) drop-shadow(0 -1px 0 #000);
  color: #fff;
  font-size: 18px;
  pointer-events: none;
}


/* Prevent YouTube's flickering scrollbar bug */

#page-manager.ytd-app {
  overflow: visible !important;
  overflow-y: visible !important;
  overflow-x: visible !important;
}
